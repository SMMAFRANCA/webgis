<!DOCTYPE html>
<html lang="pt-br">
<head>
    <style>
        /* Centralizar conte√∫do das popups do Leaflet */
        .leaflet-popup-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .leaflet-popup-content table {
            margin-left: auto;
            margin-right: auto;
        }
    </style>
    <style>
        /* Barra de rolagem nas popups do Leaflet */
        .leaflet-popup-content {
            max-height: 60vh;
            overflow-y: auto;
        }
        @media (max-width: 700px) {
            .leaflet-popup-content {
                max-height: 45vh;
            }
        }
    </style>
    <style>
        @media print {
            html, body {
                width: 100vw;
                height: 100vh;
                margin: 0 !important;
                padding: 0 !important;
            }
            body * {
                visibility: hidden !important;
            }
            #map, #map * {
                visibility: visible !important;
                page-break-before: avoid !important;
                page-break-after: avoid !important;
                break-inside: avoid !important;
            }
            #map {
                position: relative !important;
                margin: 0 auto !important;
                left: 0; right: 0; top: 0; bottom: 0;
                width: calc(100vw - 40mm) !important;
                height: calc(100vh - 40mm) !important;
                max-width: 100%;
                max-height: 100%;
                min-height: 0 !important;
                z-index: 9999 !important;
                background: #fff;
                page-break-before: avoid !important;
                page-break-after: avoid !important;
                break-inside: avoid !important;
                overflow: hidden !important;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            @page {
                size: auto;
                margin: 20mm;
            }
        }
    </style>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        #map {
            width: 100vw;
            height: 80vh;
            min-height: 350px;
            position: relative;
            z-index: 0;
            overflow: hidden;
            touch-action: none;
        }
        /* Garante que o menu n√£o esconda o mapa */
        #floating-layer-menu {
            pointer-events: auto;
        }
    </style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Web GIS</title>
        <!-- Leaflet CSS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <!-- Leaflet JS -->
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
    <header>
        <h2>Bem-vindo ao Web GIS - Franca/SP</h2>
    </header>
    <main>
        <div id="map" style="position:relative;">
            <!-- O mapa ser√° renderizado aqui -->
            <button id="layer-menu-btn" title="Camadas">‚ò∞</button>
            <div id="layer-menu-panel" class="hidden">
                <h2>Camadas</h2>
                <div id="layer-controls"></div>
            </div>
        </div>
    </main>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100vw;
            height: 80vh;
            min-height: 350px;
            position: relative;
            z-index: 0;
        }
        #layer-menu-btn {
            position: absolute;
            top: 150px;
            left: 10px;
            z-index: 1002;
            background: #027a8f;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 1.7em;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.18);
            transition: background 0.2s;
        }
        #layer-menu-btn:active {
            background: #125ea2;
        }
        #layer-menu-panel {
            position: absolute;
            top: 190px;
            left: 10px;
            z-index: 1001;
            background: rgba(247, 247, 248, 0.97);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.18);
            min-width: 180px;
            max-width: 90vw;
            padding: 10px 12px 10px 12px;
            display: block;
            font-size: 1em;
        }
        #layer-menu-panel.hidden {
            display: none;
        }
        /* Responsividade para dispositivos m√≥veis */
        @media (max-width: 700px) {
            #map {
                height: 70vh;
                min-height: 220px;
            }
            #layer-menu-btn {
                top: 120px;
                left: 4vw;
                font-size: 1em;
                padding: 7px 10px;
            }
            #layer-menu-panel {
                min-width: 110px;
                left: 4vw;
                top: 120px;
                font-size: 0.95em;
                padding: 7px 7px 7px 7px;
            }
            #layer-menu-panel h2 {
                font-size: 1em;
                margin: 0 0 6px 0;
            }
            .leaflet-control {
                font-size: 0.95em !important;
            }
            .info.legend {
                font-size: 0.95em !important;
                min-width: 90px !important;
                padding: 6px 6px !important;
            }
        }
        @media (max-width: 400px) {
            #map {
                height: 60vh;
                min-height: 120px;
            }
            #layer-menu-btn {
                top: 90px;
                font-size: 0.9em;
                padding: 5px 7px;
            }
            #layer-menu-panel {
                top: 90px;
                font-size: 0.9em;
                padding: 5px 5px 5px 5px;
            }
        }
    </style>
    <footer>
        <p>Secretaria Municipal de Meio Ambiente</p>
    </footer>
        <script>
            // Bot√£o flutuante para menu de camadas
            document.addEventListener('DOMContentLoaded', function() {
                var btn = document.getElementById('layer-menu-btn');
                var panel = document.getElementById('layer-menu-panel');
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    panel.classList.toggle('hidden');
                });
                // Fecha o painel ao clicar fora
                document.addEventListener('click', function(e) {
                    if (!panel.classList.contains('hidden') && !panel.contains(e.target) && e.target !== btn) {
                        panel.classList.add('hidden');
                    }
                });
            });

            // Inicializa√ß√£o b√°sica do Leaflet
            // Centro em Franca, SP: latitude -20.5386, longitude -47.4009
            var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            });
            var esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: 'Tiles ¬© Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
            });
            // Google Hybrid (via CartoDB Positron + Esri World Imagery + labels)
            var googleHybrid = L.layerGroup([
                L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
                    attribution: 'Map data ¬©2025 Google',
                    maxZoom: 20
                }),
                L.tileLayer('https://mt1.google.com/vt/lyrs=h&x={x}&y={y}&z={z}', {
                    attribution: '',
                    maxZoom: 20
                })
            ]);
            var map = L.map('map', {
                center: [-20.5386, -47.4009],
                zoom: 13,
                layers: [esriSat] // camada base padr√£o agora √© Esri
            });


            // Controle de impress√£o do mapa como controle Leaflet
            var PrintControl = L.Control.extend({
                options: { position: 'topright' },
                onAdd: function(map) {
                    var btn = L.DomUtil.create('button', 'leaflet-bar leaflet-control leaflet-control-custom');
                    btn.innerHTML = 'üñ®Ô∏è';
                    btn.title = 'Imprimir Mapa';
                    btn.style.width = '34px';
                    btn.style.height = '34px';
                    btn.style.fontSize = '1.3em';
                    btn.style.cursor = 'pointer';
                    btn.style.background = '#fff';
                    btn.style.border = 'none';
                    btn.style.boxShadow = '0 1px 5px rgba(0,0,0,0.3)';
                    btn.onmouseover = function() { btn.style.background = '#f4f4f4'; };
                    btn.onmouseout = function() { btn.style.background = '#fff'; };
                    L.DomEvent.on(btn, 'click', function(e) {
                        L.DomEvent.stopPropagation(e);
                        L.DomEvent.preventDefault(e);
                        window.print();
                    });
                    return btn;
                }
            });
            map.addControl(new PrintControl());

            // Barra de escala padr√£o do Leaflet
            L.control.scale({ position: 'bottomleft', imperial: false }).addTo(map);

            // Seta norte personalizada
            var NorthControl = L.Control.extend({
                options: { position: 'topright' },
                onAdd: function(map) {
                    var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-north');
                    container.style.background = 'rgba(255,255,255,0.9)';
                    container.style.padding = '2px 6px 2px 6px';
                    container.style.display = 'flex';
                    container.style.flexDirection = 'column';
                    container.style.alignItems = 'center';
                    container.innerHTML = `
                        <svg width="24" height="32" viewBox="0 0 24 32">
                          <polygon points="12,2 22,30 12,24 2,30" style="fill:#000000;stroke:#222;stroke-width:1"/>
                          <text x="12" y="18" text-anchor="middle" font-size="10" fill="#FFFFFF" font-family="Arial" font-weight="bold">N</text>
                        </svg>
                    `;
                    container.title = 'Norte';
                    return container;
                }
            });
            map.addControl(new NorthControl());



            // Fun√ß√£o para definir cor por Classe
            function getColorByClasse(classe) {
                var colors = {
                    'APP': '#1f77b4',
                    'ARL': '#ff7f0e',
                    'Reserva': '#2ca02c',
                    'Outro': '#d62728'
                };
                return colors[classe] || '#3388ff';
            }

            // Carregar todas as camadas em paralelo
            Promise.all([
                fetch('camadas/app.geojson').then(r => r.json()),
                fetch('camadas/area_institucional.geojson').then(r => r.json()),
                fetch('camadas/area_patrimonial.geojson').then(r => r.json()),
                fetch('camadas/area_verde.geojson').then(r => r.json()),
                fetch('camadas/area_uso_especial.geojson').then(r => r.json()),
                fetch('camadas/lotes.geojson').then(r => r.json()),
                fetch('camadas/lotes_emdef.geojson').then(r => r.json()),
                fetch('camadas/limite_municipal_franca.geojson').then(r => r.json()),
                fetch('camadas/area_urbana.geojson').then(r => r.json())
            ]).then(function([
                appData,
                areaInstitucionalData,
                areaPatrimonialData,
                areaVerdeData,
                areaUsoEspecialData,
                lotesData,
                lotesEmdefData,
                limiteMunicipalData,
                areaUrbanaData
            ]) {
                var appLayer = L.geoJSON(appData, {
                    style: function(feature) {
                        return {
                            color: '#ff0000', // vermelho
                            weight: 2,
                            fillOpacity: 0.3
                        };
                    },
                    onEachFeature: bindPopupAtributos
                });
                var areaInstitucionalLayer = L.geoJSON(areaInstitucionalData, {
                    style: { color: '#ffff00', weight: 2, fillOpacity: 0.4 },
                    onEachFeature: bindPopupAtributos
                });
                var areaPatrimonialLayer = L.geoJSON(areaPatrimonialData, {
                    style: { color: '#7B68EE', weight: 2, fillOpacity: 0.4 },
                    onEachFeature: bindPopupAtributos
                });
                var areaVerdeLayer = L.geoJSON(areaVerdeData, {
                    style: { color: '#00FF7F', weight: 2, fillOpacity: 0.4 },
                    onEachFeature: bindPopupAtributos
                });
                var areaUsoEspecialLayer = L.geoJSON(areaUsoEspecialData, {
                    style: { color: '#FF00FF', weight: 2, fillOpacity: 0.4 },
                    onEachFeature: bindPopupAtributos
                });
                var lotesLayer = L.geoJSON(lotesData, {
                    style: { color: '#D2691E', weight: 1.5, fillOpacity: 0.4 },
                    onEachFeature: bindPopupAtributos
                });
                var lotesEmdefLayer = L.geoJSON(lotesEmdefData, {
                    style: { color: '#0000CD', weight: 1.5, fillOpacity: 0.4, dashArray: '4 2' },
                    onEachFeature: bindPopupAtributos
                });
                var limiteMunicipalLayer = L.geoJSON(limiteMunicipalData, {
                    style: { color: '#0000CD', weight: 3, fillOpacity: 0 },
                    onEachFeature: bindPopupAtributos
                });
                var areaUrbanaLayer = L.geoJSON(areaUrbanaData, {
                    style: { color: '#00FF00', weight: 2, fillOpacity: 0.0 },
                    onEachFeature: bindPopupAtributos
                });

                // Legenda din√¢mica (sem inventario_arboreo_2019_otimo)
                var legend = L.control({ position: 'bottomright' });
                function getLegendHtml() {
                    var html = '';
                    if (map.hasLayer(appLayer)) {
                        html += '<b>APP</b><br><i style="background:#ff0000;width:18px;height:18px;display:inline-block;margin-right:6px;border:1px solid #888;vertical-align:middle;"></i> APP<br>';
                    }
                    if (map.hasLayer(areaInstitucionalLayer)) {
                        html += '<i style="background:#ffff00;width:18px;height:18px;display:inline-block;margin-right:6px;border:1px solid #888;vertical-align:middle;"></i> √Årea Institucional<br>';
                    }
                    if (map.hasLayer(areaPatrimonialLayer)) {
                        html += '<i style="background:#7B68EE;width:18px;height:18px;display:inline-block;margin-right:6px;border:1px solid #888;vertical-align:middle;"></i> √Årea Patrimonial<br>';
                    }
                    if (map.hasLayer(areaVerdeLayer)) {
                        html += '<i style="background:#00FF7F;width:18px;height:18px;display:inline-block;margin-right:6px;border:1px solid #888;vertical-align:middle;"></i> √Årea Verde<br>';
                    }
                    if (map.hasLayer(areaUsoEspecialLayer)) {
                        html += '<i style="background:#FF00FF;width:18px;height:18px;display:inline-block;margin-right:6px;border:1px solid #888;vertical-align:middle;"></i> √Årea de Uso Especial<br>';
                    }
                    if (map.hasLayer(areaUrbanaLayer)) {
                        html += '<i style="background:#00FF00;width:18px;height:18px;display:inline-block;margin-right:6px;border:1px solid #888;vertical-align:middle;"></i> √Årea Urbana<br>';
                    }
                    if (map.hasLayer(lotesLayer)) {
                        html += '<i style="background:#D2691E;width:18px;height:18px;display:inline-block;margin-right:6px;border:1px solid #888;vertical-align:middle;"></i> Lotes<br>';
                    }
                    if (map.hasLayer(lotesEmdefLayer)) {
                        html += '<i style="background:#0000CD;width:18px;height:18px;display:inline-block;margin-right:6px;border:1px solid #888;border-style:dashed;vertical-align:middle;"></i> Lotes EMDEF<br>';
                    }
                    if (map.hasLayer(limiteMunicipalLayer)) {
                        html += '<hr style="margin:6px 0;"><i style="border:3px solid #0000CD;width:18px;height:0;display:inline-block;margin-right:6px;vertical-align:middle;"></i> Limite Municipal';
                    }
                    return html;
                }
                legend.onAdd = function (map) {
                    var div = L.DomUtil.create('div', 'info legend');
                    div.style.background = 'rgba(255,255,255,0.95)';
                    div.style.padding = '8px 12px';
                    div.style.fontSize = '1em';
                    div.style.boxShadow = '0 1px 5px rgba(0,0,0,0.2)';
                    div.innerHTML = getLegendHtml();
                    return div;
                };
                function updateLegendVisibility() {
                    var overlays = [
                        appLayer,
                        areaInstitucionalLayer,
                        areaPatrimonialLayer,
                        areaVerdeLayer,
                        areaUsoEspecialLayer,
                        areaUrbanaLayer,
                        lotesLayer,
                        lotesEmdefLayer,
                        limiteMunicipalLayer
                    ];
                    var anyActive = overlays.some(function(layer) { return map.hasLayer(layer); });
                    var legendDiv = document.querySelector('.info.legend');
                    if (anyActive) {
                        if (!legendDiv) {
                            legend.addTo(map);
                            setTimeout(function() {
                                var legendDiv2 = document.querySelector('.info.legend');
                                if (legendDiv2) legendDiv2.innerHTML = getLegendHtml();
                            }, 50);
                        } else {
                            legendDiv.innerHTML = getLegendHtml();
                        }
                    } else {
                        if (legendDiv) legend.remove();
                    }
                }
                map.on('overlayadd overlayremove', updateLegendVisibility);
                map.on('layeradd layerremove', updateLegendVisibility);
                setTimeout(updateLegendVisibility, 300);
                // For√ßar atualiza√ß√£o da legenda ap√≥s adicionar a camada
                setTimeout(updateLegendVisibility, 100);

                var baseMaps = {
                    "OpenStreetMap": osm,
                    "Google Sat√©lite H√≠brido": googleHybrid,
                    "Sat√©lite (Esri)": esriSat
                };
                var overlayMaps = {
                    "APP": appLayer,
                    "√Årea Institucional": areaInstitucionalLayer,
                    "√Årea Patrimonial": areaPatrimonialLayer,
                    "√Årea Verde": areaVerdeLayer,
                    "√Årea de Uso Especial": areaUsoEspecialLayer,
                    "Lotes": lotesLayer,
                    "Lotes EMDEF": lotesEmdefLayer,
                    "√Årea Urbana": areaUrbanaLayer,
                    "Limite Municipal de Franca": limiteMunicipalLayer
                };
                var layerControl = L.control.layers(baseMaps, overlayMaps, { collapsed: false });
                layerControl.addTo(map);

                // Renderizar controles tamb√©m no menu lateral
                setTimeout(function() {
                    var controlsDiv = document.getElementById('layer-controls');
                    if (controlsDiv && layerControl && layerControl._container) {
                        layerControl._container.style.display = 'none';
                        controlsDiv.innerHTML = '';
                        controlsDiv.appendChild(layerControl._container);
                        layerControl._container.style.display = 'block';
                        var allInputs = controlsDiv.querySelectorAll('input[type="radio"], input[type="checkbox"]');
                        var allLabels = controlsDiv.querySelectorAll('label');
                        var baseNames = [
                            'Google Sat√©lite H√≠brido',
                            'OpenStreetMap',
                            'Sat√©lite (Esri)'
                        ];
                        var publicNames = [
                            'APP',
                            '√Årea Institucional',
                            '√Årea Patrimonial',
                            '√Årea de Uso Especial',
                            '√Årea Verde',
                            'Lotes',
                            'Lotes EMDEF'
                        ];
                        var baseGroup = document.createElement('div');
                        baseGroup.style.marginBottom = '12px';
                        var baseTitle = document.createElement('div');
                        baseTitle.textContent = 'Mapas Base';
                        baseTitle.style.fontWeight = 'bold';
                        baseTitle.style.margin = '8px 0 4px 0';
                        baseTitle.style.color = '#1976d2';
                        baseGroup.appendChild(baseTitle);
                        var publicGroup = document.createElement('div');
                        publicGroup.style.marginBottom = '12px';
                        var publicTitle = document.createElement('div');
                        publicTitle.style.display = 'flex';
                        publicTitle.style.alignItems = 'center';
                        publicTitle.style.gap = '8px';
                        publicTitle.style.fontWeight = 'bold';
                        publicTitle.style.margin = '8px 0 4px 0';
                        publicTitle.style.color = '#1976d2';
                        publicTitle.textContent = '√Åreas P√∫blicas';
                        // Checkbox para ativar/desativar todas as camadas p√∫blicas
                        var publicCheck = document.createElement('input');
                        publicCheck.type = 'checkbox';
                        publicCheck.style.marginLeft = '8px';
                        publicCheck.title = 'Ativar/Desativar todas as √Åreas P√∫blicas';
                        publicTitle.appendChild(publicCheck);
                        publicGroup.appendChild(publicTitle);
                        // Bot√£o de expandir/recolher
                        var toggleBtn = document.createElement('button');
                        toggleBtn.type = 'button';
                        toggleBtn.title = 'Expandir/Recolher √Åreas P√∫blicas';
                        toggleBtn.innerHTML = '‚ñº';
                        toggleBtn.style.marginRight = '8px';
                        toggleBtn.style.marginLeft = '0';
                        toggleBtn.style.fontSize = '1em';
                        toggleBtn.style.cursor = 'pointer';
                        toggleBtn.style.background = '#f4f4f4';
                        toggleBtn.style.border = '1px solid #bbb';
                        toggleBtn.style.borderRadius = '4px';
                        toggleBtn.style.padding = '2px 6px';
                        toggleBtn.style.width = '28px';
                        toggleBtn.style.height = '28px';
                        publicTitle.insertBefore(toggleBtn, publicTitle.firstChild);
                        var otherGroup = document.createElement('div');
                        // Agrupar labels do grupo em um container
                        var publicLabelsContainer = document.createElement('div');
                        publicLabelsContainer.className = 'public-labels-container';
                        publicGroup.appendChild(publicLabelsContainer);
                        // Distribui labels nos grupos
                        var publicLabels = [];
                        allLabels.forEach(function(label) {
                            var text = label.textContent.trim().replace('üîç','').trim();
                            var input = label.querySelector('input');
                            if (input && input.type === 'radio' && baseNames.includes(text)) {
                                baseGroup.appendChild(label);
                            } else if (input && input.type === 'checkbox' && publicNames.includes(text)) {
                                publicLabelsContainer.appendChild(label);
                                publicLabels.push(input);
                            } else if (input && input.type === 'checkbox') {
                                otherGroup.appendChild(label);
                            }
                        });
                        // Ap√≥s distribuir os labels nos grupos, adicionar bot√£o de zoom para cada camada
                        function addZoomButton(label, layer) {
                            var btn = document.createElement('button');
                            btn.type = 'button';
                            btn.title = 'Aproximar para a camada';
                            btn.innerHTML = 'üîç';
                            btn.style.marginLeft = '8px';
                            btn.style.fontSize = '1em';
                            btn.style.cursor = 'pointer';
                            btn.style.background = '#f4f4f4';
                            btn.style.border = '1px solid #bbb';
                            btn.style.borderRadius = '4px';
                            btn.style.padding = '2px 6px';
                            btn.onclick = function(e) {
                                e.stopPropagation();
                                if (layer && layer.getBounds && layer.getLayers && layer.getLayers().length > 0) {
                                    map.fitBounds(layer.getBounds(), { maxZoom: 18 });
                                } else if (layer && layer.getBounds) {
                                    map.fitBounds(layer.getBounds(), { maxZoom: 18 });
                                }
                            };
                            label.appendChild(btn);
                        }
                        // Mapear nomes para layers
                        var layerMap = {
                            'APP': appLayer,
                            '√Årea Institucional': areaInstitucionalLayer,
                            '√Årea Patrimonial': areaPatrimonialLayer,
                            '√Årea Verde': areaVerdeLayer,
                            '√Årea de Uso Especial': areaUsoEspecialLayer,
                            'Lotes': lotesLayer,
                            'Lotes EMDEF': lotesEmdefLayer,
                            '√Årea Urbana': areaUrbanaLayer,
                            'Limite Municipal de Franca': limiteMunicipalLayer
                        };
                        allLabels.forEach(function(label) {
                            var text = label.textContent.trim().replace('üîç','').trim();
                            if (layerMap[text]) {
                                addZoomButton(label, layerMap[text]);
                            }
                        });
                        // L√≥gica do checkbox do grupo √Åreas P√∫blicas
                        function updatePublicCheck() {
                            var allChecked = publicLabels.length > 0 && publicLabels.every(function(inp) { return inp.checked; });
                            publicCheck.checked = allChecked;
                            publicCheck.indeterminate = !allChecked && publicLabels.some(function(inp) { return inp.checked; });
                        }
                        publicCheck.addEventListener('change', function() {
                            publicLabels.forEach(function(inp) {
                                if (inp.checked !== publicCheck.checked) inp.click();
                            });
                        });
                        publicLabels.forEach(function(inp) {
                            inp.addEventListener('change', updatePublicCheck);
                        });
                        // Estado inicial: expandido
                        var expanded = true;
                        function updateExpand() {
                            publicLabelsContainer.style.display = expanded ? 'block' : 'none';
                            toggleBtn.innerHTML = expanded ? '‚ñº' : '‚ñ∫';
                        }
                        toggleBtn.addEventListener('click', function() {
                            expanded = !expanded;
                            updateExpand();
                        });
                        updateExpand();
                        controlsDiv.appendChild(baseGroup);
                        controlsDiv.appendChild(publicGroup);
                        if (otherGroup.childNodes.length > 0) {
                            var otherTitle = document.createElement('div');
                            otherTitle.textContent = 'Outras Camadas';
                            otherTitle.style.fontWeight = 'bold';
                            otherTitle.style.margin = '8px 0 4px 0';
                            controlsDiv.appendChild(otherTitle);
                            controlsDiv.appendChild(otherGroup);
                        }
                    }
                }, 500);

                // Adicionar apenas a camada Limite Municipal de Franca ao mapa ap√≥s tudo pronto
                limiteMunicipalLayer.addTo(map);
            });

            // Fun√ß√£o para popups de atributos
            function bindPopupAtributos(feature, layer) {
                if (feature.properties) {
                    var html = '<strong>Atributos:</strong><br><table style="font-size:0.98em">';
                    var hasData = false;
                    for (var key in feature.properties) {
                        if (feature.properties.hasOwnProperty(key) && feature.properties[key] !== null && feature.properties[key] !== "") {
                            hasData = true;
                            html += '<tr><td><b>' + key + '</b></td><td>' + feature.properties[key] + '</td></tr>';
                        }
                    }
                    html += '</table>';
                    if (hasData) {
                        layer.bindPopup(html);
                    }
                }
            }

            // O controle de visibilidade agora √© feito pelo controle de camadas do Leaflet

            // Legenda personalizada
        </script>
    <style>
        #layer-controls {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        #layer-controls label {
            display: flex;
            align-items: center;
            margin-bottom: 2px;
            font-size: 1em;
            gap: 6px;
        }
    </style>
</body>
</html>